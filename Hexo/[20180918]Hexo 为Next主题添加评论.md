---
layout: post
author: sjf0115
title: Hexo 为Next主题添加评论功能
date: 2018-09-18 21:14:01
tags:
  - Hexo

categories: Hexo
permalink: add-a-comment-function-to-the-next-theme-of-hexo
---

### 1. 添加评论功能

之前使用的[来必力](https://livere.com)，最近评论功能一直出不来，用户体验比较差，所以重新评估选择了[Valine](https://valine.js.org/)。

#### 1.1 创建账号

这个评论系统是基于 LeanCloud 进行的，先去注册一个账号，点[这里](https://leancloud.cn/)进行注册。

[点这里](https://leancloud.cn/dashboard/applist.html#/newapp)创建应用，应用名看个人喜好。选择刚刚创建的应用，点击设置按钮，再点击应用Key按钮，你就能看到你的`APP ID`和`APP KEY`了：

![](https://github.com/sjf0115/PubLearnNotes/blob/master/image/Hexo/add-a-comment-function-to-the-next-theme-of-hexo-1.png?raw=true)

为了您的数据安全，请填写`应用>设置>安全设置`中的Web 安全域名，如下图：

![](https://github.com/sjf0115/PubLearnNotes/blob/master/image/Hexo/add-a-comment-function-to-the-next-theme-of-hexo-2.png?raw=true)

#### 1.2 配置

修改你主题目录下的`_config.yml`文件：
```
valine:
  enable: true
  appid:  # 你的 App ID
  appkey: # 你的 App Key
  notify: false # mail notifier , https://github.com/xCss/Valine/wiki
  verify: false # Verification code
  placeholder: 有什么问题，欢迎留言指正与交流... # comment box placeholder
  avatar: robohash # gravatar style
  guest_info: nick,mail,link # custom comment header
  pageSize: 10 # pagination size
```
发布之后，我们看一下效果如何：

![](https://github.com/sjf0115/PubLearnNotes/blob/master/image/Hexo/add-a-comment-function-to-the-next-theme-of-hexo-3.png?raw=true)

在进行评论之后，我们可以从后台看一下我们的评论数据：

![](https://github.com/sjf0115/PubLearnNotes/blob/master/image/Hexo/add-a-comment-function-to-the-next-theme-of-hexo-7.png?raw=true)

这样我们就可以管理我们的评论数据了。

### 2. 设置评论头像

目前默认头像有以下7种默认值可选:

![](https://github.com/sjf0115/PubLearnNotes/blob/master/image/Hexo/add-a-comment-function-to-the-next-theme-of-hexo-5.png?raw=true)

下面我们换一种头像展现，在NexT主题中，进行如下修改，把我们的默认头像修改为一种具有不同颜色、面部等的机器人：
```
avatar: robohash # gravatar style
```

![](https://github.com/sjf0115/PubLearnNotes/blob/master/image/Hexo/add-a-comment-function-to-the-next-theme-of-hexo-3.png?raw=true)

如果想自定义我们的头像，我们可以在[这](https://cn.gravatar.com)点击进行创建用户，并上传自己的头像：

![](https://github.com/sjf0115/PubLearnNotes/blob/master/image/Hexo/add-a-comment-function-to-the-next-theme-of-hexo-6.png?raw=true)

经过一定时间的数据全球化同步，头像会根据你设置的 E-mail 进行匹配：

![](https://github.com/sjf0115/PubLearnNotes/blob/master/image/Hexo/add-a-comment-function-to-the-next-theme-of-hexo-4.png?raw=true)

> 如果想显示我们上传的头像，在进行评论时一定要留下设置的 E-mail 账号，否则会显示默认头像。

### 3. 邮件提醒

进入`Leancloud`>选择你的评论所存放的`应用>设置>邮件模板`，按下图设置好用于`重置密码`的邮件主题>然后保存:

![](https://github.com/sjf0115/PubLearnNotes/blob/master/image/Hexo/add-a-comment-function-to-the-next-theme-of-hexo-8.png?raw=true)

> 请注意修改链接为你的博客或者网站首页。

```
<p>Hi, {{username}}</p>
<p>
你在 {{appname}} 的评论收到了新的回复，请点击查看：
</p>
<p><a href="你的网址首页链接" style="display: inline-block; padding: 10px 20px; border-radius: 4px; background-color: #3090e4; color: #fff; text-decoration: none;">马上查看</a></p>
```

注意事项:
- 发送次数过多，可能会暂时被Leancloud 屏蔽邮件发送功能
- 由于邮件提醒功能使用的Leancloud的密码重置邮件提醒，只能传递昵称、邮箱两个属性，所以邮件提醒链接无法直达指定文章页。请悉知。
- 开启邮件提醒会默认开启验证码选项。
- 该功能目前还在测试阶段，谨慎使用。
- 目前邮件提醒正处于测试阶段，仅在子级对存在邮件地址的父级发表评论时发送邮件

### 4. 增强版邮件提醒





资料：[头像配置](https://valine.js.org/avatar.html)

[Valine -- 一款极简的评论系统](https://ioliu.cn/2017/add-valine-comments-to-your-blog/)

[邮件提醒](https://valine.js.org/notify.html)
