
本文介绍了在 Flink 中使用定时器的一些基本概念和注意事项。开发人员可以使用 Flink 的 ProcessFunction 算子注册他们自己的定时器，该算子可以访问流应用程序的一些基本构建块，例如：
- 事件（流元素）
- 状态（容错，一致性，仅在 KeyedStream 上应用）
- 定时器（事件时间和处理时间，仅在 KeyedStream 上应用）

有关 Flink ProcessFunction 的更多信息，请参考。

### 1. 什么是定时器

定时器可以使 Flink 流处理程序对处理时间和事件时间的变化作出反应。我们之前的一篇[文章](http://smartsi.club/flink-stream-event-time-and-processing-time.html)更详细地介绍了 Flink 中不同概念的时间以及处理时间，事件时间以及摄入时间之间的差异。使用定时器处理事件流时，每次调用 `processElement（...）` 时，我们可以借助 Context 对象访问元素的事件时间戳和 TimerService。然后我们使用 TimerService 为将来的事件时间/处理时间实例注册回调。这样之后，一旦达到定时器的特定时刻，会调用 `onTimer（...）` 方法。

`onTimer（...）` 回调在不同时间点被调用，首先取决于是否使用处理时间或事件时间注册定时器。特别是：
- 使用处理时间注册定时器时，当机器的系统时间达到定时器的时间戳时，会调用 `onTimer（...）` 方法。
- 使用事件时间注册定时器时，当算子的 Watermark 达到或超过定时器的时间戳时，会调用 `onTimer（...）` 方法。

与 `processElement（...）` 方法类似，`onTimer（...）` 回调中的状态访问也仅局限于当前 key（即，为其注册定时器的 key）。

值得注意的是，`onTimer（...）` 和 `processElement（...）` 调用都是同步的，因此同时在 `onTimer（...）` 和 `processElement（..）` 方法中访问状态并修改都是安全的。




英译对照:
- 定时器: Timers
- 状态: state
- 摄入时间: Ingestion Time
