### 1. 背景

假设，我们正在使用一个TB级别的数据集，你有一个MapReduce应用程序要使用该数据集进行测试。在该数据集上运行MapReduce应用程序可能需要几个小时甚至更多，并不断地进行代码迭代与优化，并且重新运行的时候可能并不是最佳一种工作流程。还有一种情况，我们在使用机器学习进行数据挖掘的时候，我们需要抽取其中一部分数据进行训练，现在抽取海量数据进行训练可能需要很多时间。

为了解决上述问题，我们可以使用样本。在MapReduce的背景下，抽样提供了与大型数据集一起使用的机会，不需要等待整个数据集被读取和处理的开销。这大大提高了在开发和调试MapReduce代码时快速迭代的能力。

我们需要对MapReduce作业进行迭代开发，并具想使用大型数据集来进行迭代测试。使用整个数据集需要很长时间，并阻碍我们快速迭代代码的能力。

### 2. 问题

在对MapReduce作业进行迭代开发期间，我们只想使用大型数据集中一小部分数据进行测试。

### 3. 解决方案

需要自定义一个InputFormat来封装读取数据的默认InputFormat。自定义的InputFormat可以配置从默认InputFormat中抽取的样本个数。这里我们可以采用蓄水池抽样算法来抽取样本。蓄水池抽样算法可以从数据流中随机采样。因此特别适合于MapReduce，因为在MapReduce中，数据源的形式就是数据流。

如果进行输入拆分以及记录读取将委派给自定义`InputFormat`和`RecordReader`类。我们需要做的是编写提供抽样功能的类，并自定义InputFormat和RecordReader类。下面显示`ReservoirSamplerRecordReader`如何工作:
```java

```
